!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ManhattanAssets=e():t.ManhattanAssets=e()}(this,function(){return function(t){function __webpack_require__(s){if(e[s])return e[s].exports;var r=e[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.p="",__webpack_require__(0)}([function(t,e,s){t.exports=s(12)},,,,,function(t,e,s){var r,i,n,o,a,u,h;r=s(6),i=s(7).Acceptor,n=s(8).Asset,a=s(9).Monitor,u=s(10).Uploader,h=s(11).Viewer,o=function(){function Field(t,e){null==e&&(e={}),r.config(this,{endpoint:"/upload-asset",label:"Select a file..."},e,t,this.constructor.clsPrefix),this._dom={},this._dom.input=t,this._dom.input.__mh_asset_field=this,this._dom.field=r.create("div",{class:this._bem("mh-asset-field")}),t.parentNode.insertBefore(this._dom.field,t),Object.defineProperty(this,"asset",{get:function(t){return function(){return t._asset}}(this),set:function(t){return function(e){return t._asset=e,t._asset?t.input.value=JSON.stringify(t._asset.toJSONType()):t.input.value="",t._update(),r.dispatch(t.input,t._et("change"),{asset:t.asset})}}(this)}),Object.defineProperty(this,"field",{value:this._dom.field}),Object.defineProperty(this,"input",{value:this._dom.input}),Object.defineProperty(this,"upload",{get:function(t){return function(){return t._upload}}(this)}),this.input.style.display="none",this._asset=null,this.input.value&&(this._asset=n.fromJSONType(JSON.parse(this.input.value))),this._uploader=null,this._upload=null,this._update()}return Field.clsPrefix="data-mh-asset-field--",Field.prototype._bem=function(t,e,s){var r;return null==e&&(e=""),null==s&&(s=""),r=t,e&&(r=r+"__"+e),s&&(r=r+"--"+s),r},Field.prototype._et=function(t){return"mh-assets--"+t},Field.prototype._update=function(){var t,e,s;return this.field.innerHTML="",this.asset?(s=new h(this.asset),r.listen(s.view,{"mh-assets--remove-asset":function(t){return function(){return t.asset=null}}(this)}),this.field.appendChild(s.view)):this.upload?(e=new a(this._uploader,this.upload),this.field.appendChild(e.monitor)):(t=new i(this.label),this.field.appendChild(t.acceptor),this._uploader=new u(t.input,{endpoint:this.endpoint}),r.listen(t.input,{"mh-assets--upload-abort":function(t){return function(e){return t._upload=null,t._update()}}(this),"mh-assets--upload-error":function(t){return function(e){return t._upload=null,t._update()}}(this),"mh-assets--upload-start":function(t){return function(e){return t._upload=e.ref,t._update()}}(this),"mh-assets--upload-success":function(t){return function(e){return t._upload=null,t.asset=e.asset}}(this)}))},Field}(),t.exports={Field:o}},function(t,e,s){!function(e,s){t.exports=s()}(this,function(){return function(t){function __webpack_require__(s){if(e[s])return e[s].exports;var r=e[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.p="",__webpack_require__(0)}([function(t,e,s){t.exports=s(1)},function(t,e){var s,r,i,n,o,a,u,h,l,p,c=[].indexOf||function(t){for(var e=0,s=this.length;e<s;e++)if(e in this&&this[e]===t)return e;return-1};s=function(t,e){var s;if(t.closest)return t.closest(e);for(s=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t&&!s.call(t,e);)t=t.parentElement;return t},i=function(t,e){var s,r,i;null==e&&(e={}),s=document.createElement(t);for(r in e)i=e[r],c.call(s,r)>=0?s[r]=i:s.setAttribute(r,i);return s},l=function(t,e){return null==e&&(e=document),Array.prototype.slice.call(e.querySelectorAll(t))},p=function(t,e){return null==e&&(e=document),e.querySelector(t)},o=function(t,e,s){var r,i,n;null==s&&(s={}),r=document.createEvent("Event"),r.initEvent(e,!0,!0);for(i in s)n=s[i],r[i]=n;return t.dispatchEvent(r)},u=function(t,e){var s,r,i,n;n=[];for(r in e)i=e[r],n.push(function(){var e,n,o,a;for(o=r.split(/\s+/),a=[],e=0,n=o.length;e<n;e++)s=o[e],a.push(t.removeEventListener(s,i));return a}());return n},h=function(t,e){var s,r,i,n;n=[];for(r in e)i=e[r],n.push(function(){var e,n,o,a;for(o=r.split(/\s+/),a=[],e=0,n=o.length;e<n;e++)s=o[e],a.push(t.addEventListener(s,i));return a}());return n},r=function(t,e,s,r,i){var n,o,a,u;null==i&&(i="data-"),a=[];for(o in e)u=e[o],t[o]=u,s.hasOwnProperty(o)&&(t[o]=s[o]),r&&(n=i+o.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r.hasAttribute(n)?"number"==typeof u?a.push(t[o]=parseInt(r.getAttribute(n))):u===!1?a.push(t[o]=!0):a.push(t[o]=r.getAttribute(n)):a.push(void 0));return a},a=function(t){return t.replace(/[\^\$\\\.\*\+\?\(\)\[\]\{\}\|]/g,"\\$&")},n=function(t){var e;try{document.querySelector(t)}catch(t){return e=t,!1}return!0},t.exports={closest:s,create:i,one:p,many:l,dispatch:o,ignore:u,listen:h,config:r,escapeRegExp:a,cssSelectorSupported:n}}])})},function(t,e,s){var r,i;r=s(6),i=function(){function Acceptor(t){null==t&&(t="Select a file..."),this._dom={},this._dom.acceptor=r.create("div",{class:this._bem("mh-assets-acceptor")}),this._dom.acceptor.__mh_acceptor=this,this._dom.input=r.create("input",{class:this._bem("mh-assets-acceptor","input"),type:"file",name:"acceptor__"+this._newId()}),this._dom.acceptor.appendChild(this._dom.input),this._dom.label=r.create("div",{class:this._bem("mh-assets-acceptor","label")}),this._dom.label.textContent=t,this._dom.acceptor.appendChild(this._dom.label),Object.defineProperty(this,"acceptor",{value:this._dom.acceptor}),Object.defineProperty(this,"input",{value:this._dom.input})}return Acceptor._counter=0,Acceptor.prototype._bem=function(t,e,s){var r;return null==e&&(e=""),null==s&&(s=""),r=t,e&&(r=r+"__"+e),s&&(r=r+"--"+s),r},Acceptor.prototype._newId=function(){return Acceptor._counter+=1,Acceptor._counter},Acceptor}(),t.exports={Acceptor:i}},function(t,e){var s,r;s=function(){function Asset(t,e,s,i,n,o,a,u){this._key=t,this._filename=e,this._type=s,this._contentType=i,this._urls=n,this.meta=new r(o,a),this._variations=u,Object.defineProperty(this,"key",{value:this._key}),Object.defineProperty(this,"filename",{value:this._filename}),Object.defineProperty(this,"type",{value:this._type}),Object.defineProperty(this,"contentType",{value:this._contentType}),Object.defineProperty(this,"urls",{get:function(t){return function(){var e,s,r;n={},s=t._urls;for(e in s)r=s[e],n[e]=r;return n}}(this)})}return Asset.prototype.toJSONType=function(){return{key:this.key,filename:this.filename,type:this.type,content_type:this.contentType,url:this.urls.origin,core_meta:this.meta.getCoreMeta(),user_meta:this.meta.getUserMeta(),variations:this._variations}},Asset.fromJSONType=function(t){var e;return e={origin:t.url},"image"===t.type&&t.variations&&(t.variations["--draft--"]&&(e.draft=t.variations["--draft--"].url),t.variations["--thumb--"]&&(e.thumb=t.variations["--thumb--"].url)),new Asset(t.key,t.filename,t.type,t.content_type,e,t.core_meta,t.user_meta,t.variations)},Asset}(),r=function(){function AssetMeta(t,e){var s,r,i,n,o,a,u,h;this._coreMeta=t||{},this._coreOverrides={},r=function(t){return function(e){return t=t,function(){return void 0!==t._coreOverrides[e]?t._coreOverrides[e]:void 0!==t._coreMeta[e]?t._coreMeta[e]:void 0}}}(this),u=function(t){return function(e){return t=t,function(s){return t._coreOverrides[e]=s}}}(this),o=this._coreMeta;for(n in o)s=o[n],Object.defineProperty(this,n,{get:r(n),set:u(n)});a=e||{};for(i in a)h=a[i],this[i]=h}return AssetMeta.prototype.getCoreMeta=function(){return JSON.parse(JSON.stringify(this._coreMeta))},AssetMeta.prototype.getUserMeta=function(){var t,e,s,r;t=JSON.parse(JSON.stringify(this._coreOverrides)),s=this;for(e in s)r=s[e],this.hasOwnProperty(e)&&!this[e]instanceof Function&&(t[e]=r);return JSON.parse(JSON.stringify(t))},AssetMeta}(),t.exports={Asset:s}},function(t,e,s){var r,i;r=s(6),i=function(){function Monitor(t,e){this._uploader=t,this._upload=e,this._dom={},this._dom.monitor=r.create("div",{class:this._bem("mh-assets-monitor")}),this._dom.monitor.__mh_monitor=this,Object.defineProperty(this,"uploader",{value:this._uploader}),Object.defineProperty(this,"upload",{value:this._upload}),Object.defineProperty(this,"monitor",{value:this._dom.monitor}),r.listen(this.uploader.input,{"mh-assets--upload-progress":function(t){return function(e){if(e.ref===t.upload)return t._dom.gauge.setAttribute("data-mh-progress",parseInt(100*e.progress)+"%"),t._dom.progress.style.width=100*e.progress+"%"}}(this),"mh-assets--upload-end":function(t){return function(e){if(e.ref===t.upload)return t.monitor.classList.add(t._bem("mh-asset-monitor","","complete")),r.dispatch(t.monitor,t._et("monitor-complete"))}}(this)}),this._template()}return Monitor.prototype._bem=function(t,e,s){var r;return null==e&&(e=""),null==s&&(s=""),r=t,e&&(r=r+"__"+e),s&&(r=r+"--"+s),r},Monitor.prototype._et=function(t){return"mh-assets--"+t},Monitor.prototype._template=function(){return this._dom.gauge=r.create("div",{class:this._bem("mh-assets-monitor","gauge"),"data-mh-progress":"0%"}),this.monitor.appendChild(this._dom.gauge),this._dom.progress=r.create("div",{class:this._bem("mh-assets-monitor","progress")}),this._dom.gauge.appendChild(this._dom.progress),this._dom.cancel=r.create("div",{class:this._bem("mh-assets-monitor","cancel")}),this.monitor.appendChild(this._dom.cancel),r.listen(this._dom.cancel,{click:function(t){return function(e){return e.preventDefault(),t.uploader.cancel(t.upload)}}(this)})},Monitor}(),t.exports={Monitor:i}},function(t,e,s){var r,i,n;r=s(6),i=s(8).Asset,n=function(){function Uploader(t,e){null==e&&(e={}),this._dom={},this._dom.input=t,this._dom.input.__mh_assets_uploader=this,this._uploads={},this._queued_uploads=[],Object.defineProperty(this,"input",{value:this._dom.input}),Object.defineProperty(this,"uploadCount",{get:function(t){return function(){var e,s;return function(){var t,r;t=this._uploads,r=[];for(s in t)e=t[s],r.push(s);return r}.call(t).length}}(this)}),r.config(this,{allowMultiple:!1,endpoint:"/cms/upload-asset",maxConcurrentUploads:2},e),this._behaviours={},r.config(this._behaviours,{formData:"manhattan",response:"manhattan"},e),this.allowMultiple&&this.input.setAttribute("multiple",!0),r.listen(this.input,{change:function(t){return function(e){var s,r,i,n;if(t.allowMultiple)for(n=e.target.files,r=0,i=n.length;r<i;r++)s=n[r],t._upload(s);else t._upload(e.target.files[0]);if(t.input.value="",t.input.value)return t.input.type="text",t.input.type="file"}}(this)})}return Uploader.prototype.cancel=function(t){var e,s,r;if(!t){r=[];for(s in uploads)e=uploads[s],r.push(s.abort());return r}if(this._uploads[t])return t.abort()},Uploader.prototype.progress=function(t){var e,s,r;if(!t){r=0;for(e in uploads)s=uploads[e],r+=s.progress;return r/Math.max(1,this.uploadCount)}if(this._uploads[t])return this._uploads[t].progress},Uploader.prototype._clear=function(t){var e;return this._uploads[t]&&delete this._uploads[t],this._queued_uploads.length>0&&(e=this._queued_uploads.shift(),this._start_upload(e[0],e[1])),r.dispatch(this.input,this._et("upload-end"),{ref:t})},Uploader.prototype._start_upload=function(t,e){return this._uploads[t]={progress:0},r.dispatch(this.input,this._et("upload-start"),{ref:t}),t.open("POST",this.endpoint,!0),t.send(e)},Uploader.prototype._et=function(t){return"mh-assets--"+t},Uploader.prototype._on_abort=function(t){if(this._uploads[t])return r.dispatch(this.input,this._et("upload-abort"),{ref:t}),this._clear(t)},Uploader.prototype._on_error=function(t,e){if(null==e&&(e=""),this._uploads[t])return r.dispatch(this.input,this._et("upload-error"),{ref:t,reason:e}),this._clear(t)},Uploader.prototype._on_progress=function(t,e){if(this._uploads[t])return this._uploads[t].progress=e,r.dispatch(this.input,this._et("upload-progress"),{ref:t,progress:e})},Uploader.prototype._on_success=function(t,e){if(this._uploads[t])return r.dispatch(this.input,this._et("upload-success"),{ref:t,asset:e}),this._clear(t)},Uploader.prototype._upload=function(t){var e,s,r,n,o,a,u,h;return s=this._behaviours.formData,e=this.constructor.behaviours.formData[s],r=e(this,t),h=new XMLHttpRequest,u=function(t,e){return function(s){return t._on_progress(e,s.loaded/s.total)}},h.upload.addEventListener("progress",u(this,h)),a=function(t,r){return function(n){var o,a,u;return u=n.target.responseText,s=t._behaviours.response,a=t.constructor.behaviours,e=a.response[s],o=e(this,r.responseText),o instanceof i?t._on_success(r,o):t._on_error(r,o.message)}},h.addEventListener("load",a(this,h)),o=function(t,e){return function(s){return t._on_error(e)}},h.addEventListener("error",o(this,h)),n=function(t,e){return function(s){return t._on_abort(e)}},h.addEventListener("abort",n(this,h)),this.uploadCount<this.maxConcurrentUploads?this._start_upload(h,r):this._queued_uploads.push([h,r])},Uploader.behaviours={formData:{manhattan:function(t,e){var s,i;return i=new FormData,i.append("file",e),s=r.one('[name="csrf_token"]',t.input.form),s&&i.append("csrf_token",s.value),i}},response:{manhattan:function(t,e){var s,r;try{r=JSON.parse(e)}catch(t){return s=t,new Error("Unable to parse response")}return"success"===r.status?i.fromJSONType(r.payload.asset):new Error(r.payload.reason)}}},Uploader}(),t.exports={Uploader:n}},function(t,e,s){var r,i;r=s(6),i=function(){function Viewer(t){this._asset=t,this._dom={},this._dom.view=r.create("div",{class:this._bem("mh-assets-view")}),this._dom.view.__mh_viewer=this,Object.defineProperty(this,"asset",{value:this._asset}),Object.defineProperty(this,"view",{value:this._dom.view}),this._template(),this._populate()}return Viewer.prototype._bem=function(t,e,s){var r;return null==e&&(e=""),null==s&&(s=""),r=t,e&&(r=r+"__"+e),s&&(r=r+"--"+s),r},Viewer.prototype._et=function(t){return"mh-assets--"+t},Viewer.prototype._populate=function(){var t,e;return"image"===this.asset.type?this.view.classList.add(this._bem("mh-assets-view","","image")):this.view.classList.add(this._bem("mh-assets-view","","file")),"image"===this.asset.type?this._dom.thumb.style["background-image"]="url("+this.asset.urls.thumb+")":this._dom.icon.setAttribute("data-mh-content-type",this.asset.contentType),this._dom.filename.textContent=this.asset.filename,this.asset.meta.length&&(t=this.asset.meta.length/1e3,e="kb",t>1e3&&(t/=1e3,e="mb"),t=t.toFixed(1),t=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),this._dom.fileSize.textContent=""+t+e),this._dom.download.setAttribute("href",this.asset.urls.origin)},Viewer.prototype._template=function(){return this._dom.content=r.create("div",{class:this._bem("mh-assets-view","content")}),this.view.appendChild(this._dom.content),this._dom.icon=r.create("div",{class:this._bem("mh-assets-view","icon")}),this._dom.content.appendChild(this._dom.icon),this._dom.thumb=r.create("div",{class:this._bem("mh-assets-view","thumb")}),this._dom.content.appendChild(this._dom.thumb),this._dom.info=r.create("div",{class:this._bem("mh-assets-view","info")}),this.view.appendChild(this._dom.info),this._dom.filename=r.create("div",{class:this._bem("mh-assets-view","filename")}),this._dom.info.appendChild(this._dom.filename),this._dom.fileSize=r.create("div",{class:this._bem("mh-assets-view","file-size")}),this._dom.info.appendChild(this._dom.fileSize),this._dom.actions=r.create("div",{class:this._bem("mh-assets-view","actions")}),this.view.appendChild(this._dom.actions),this._dom.download=r.create("a",{download:!0,target:"_blank"}),this._dom.download.classList.add(this._bem("mh-assets-view","action")),this._dom.download.classList.add(this._bem("mh-assets-view","action","download")),this._dom.download.textContent="Download",this._dom.actions.appendChild(this._dom.download),this._dom.remove=r.create("a",{href:"#"}),this._dom.remove.classList.add(this._bem("mh-assets-view","action")),this._dom.remove.classList.add(this._bem("mh-assets-view","action","remove")),this._dom.remove.textContent="Remove",this._dom.actions.appendChild(this._dom.remove),r.listen(this._dom.remove,{click:function(t){return function(e){return e.preventDefault(),r.dispatch(t.view,t._et("remove-asset"),{asset:t.asset})}}(this)})},Viewer}(),t.exports={Viewer:i}},function(t,e,s){var r,i;r=s(5).Field,i=s(13).Gallery,t.exports={Field:r,Gallery:i}},function(t,e,s){var r,i,n,o,a,u,h,l;r=s(6),u=s(14).Sortable,i=s(7).Acceptor,n=s(8).Asset,a=s(9).Monitor,h=s(10).Uploader,l=s(11).Viewer,o=function(){function Gallery(t,e){var s,i,o,a,u;if(null==e&&(e={}),r.config(this,{endpoint:"/upload-asset",label:"Select a file..."},e,t,this.constructor.clsPrefix),this._assets=[],this._dom={},this._dom.input=t,this._dom.input.__mh_asset_gallery=this,this._dom.gallery=r.create("div",{class:this._bem("mh-asset-gallery")}),t.parentNode.insertBefore(this._dom.gallery,t),this._dom.assetsView=r.create("div",{class:this._bem("mh-asset-gallery__assets-view")}),this._dom.gallery.appendChild(this._dom.assetsView),this._dom.uploadControl=r.create("div",{class:this._bem("mh-asset-gallery__upload-control")}),this._dom.gallery.appendChild(this._dom.uploadControl),Object.defineProperty(this,"assets",{get:function(t){return function(){return t._assets}}(this)}),Object.defineProperty(this,"assetsView",{value:this._dom.assetsView}),Object.defineProperty(this,"gallery",{value:this._dom.gallery}),Object.defineProperty(this,"input",{value:this._dom.input}),Object.defineProperty(this,"upload",{get:function(t){return function(){return t._upload}}(this)}),Object.defineProperty(this,"uploadControl",{value:this._dom.uploadControl}),this._assetViewers={},s=[],this.input.value)for(u=JSON.parse(this.input.value),i=0,o=u.length;i<o;i++)a=u[i],s.push(n.fromJSONType(a));this.addAssets(s),this._uploader=null,this._upload=null,this._updateUploadControl()}return Gallery.clsPrefix="data-mh-asset-gallery--",Gallery.prototype.addAsset=function(t){var e;return this._assets.push(t),e=new l(t),this._assetViewers[t.key]=e,r.listen(e.view,{"mh-assets--remove-asset":function(t){return function(e){return t.removeAsset(e.asset)}}(this)}),this.assetsView.appendChild(e.view),this._syncInput(),this._updateSorting(),r.dispatch(this.input,this._et("change"),{asset:this.asset})},Gallery.prototype.addAssets=function(t){var e,s,i,n;for(s=0,i=t.length;s<i;s++)e=t[s],this._assets.push(e),n=new l(e),this._assetViewers[e.key]=n,r.listen(n.view,{"mh-assets--remove-asset":function(t){return function(e){return t.removeAsset(e.asset)}}(this)}),this.assetsView.appendChild(n.view);return this._syncInput(),this._updateSorting(),r.dispatch(this.input,this._et("change"),{asset:this.asset})},Gallery.prototype.removeAsset=function(t){var e,s,r,i,n,o;for(n=this.assets,s=r=0,i=n.length;r<i;s=++r)if(e=n[s],t.key===e.key){this._assets.splice(s,1);break}if(this._syncInput(),this._updateSorting(),o=this._assetViewers[t.key])return this.assetsView.removeChild(o.view),delete this._assetViewers[t.key]},Gallery.prototype._bem=function(t,e,s){var r;return null==e&&(e=""),null==s&&(s=""),r=t,e&&(r=r+"__"+e),s&&(r=r+"--"+s),r},Gallery.prototype._et=function(t){return"mh-assets--"+t},Gallery.prototype._syncInput=function(){var t,e,s,r,i;for(e=[],i=this.assets,s=0,r=i.length;s<r;s++)t=i[s],e.push(t.toJSONType());return this.input.value=JSON.stringify(e)},Gallery.prototype._updateSorting=function(){var t;if(this.assetsView.__mh_sortable&&this.assetsView.__mh_sortable.destroy(),this.assets.length>1)return t=new u(this.assetsView,{axis:"horizontal"}),r.listen(t.container,{"mh-sortable--sorted":function(t){return function(e){var s,r,i,n,o;for(o=[],n=e.children,r=0,i=n.length;r<i;r++)s=n[r],o.push(s.__mh_viewer.asset);return t._assets=o,t._syncInput()}}(this)})},Gallery.prototype._updateUploadControl=function(){var t,e;return this.uploadControl.innerHTML="",this.upload?(e=new a(this._uploader,this.upload),this.uploadControl.appendChild(e.monitor)):(t=new i(this.label),this.uploadControl.appendChild(t.acceptor),this._uploader=new h(t.input,{endpoint:this.endpoint}),r.listen(t.input,{"mh-assets--upload-abort":function(t){return function(e){return t._upload=null,t._updateUploadControl()}}(this),"mh-assets--upload-error":function(t){return function(e){return t._upload=null,t._updateUploadControl()}}(this),"mh-assets--upload-start":function(t){return function(e){return t._upload=e.ref,t._updateUploadControl()}}(this),"mh-assets--upload-success":function(t){return function(e){return t._upload=null,t._updateUploadControl(),t.addAsset(e.asset)}}(this)}))},Gallery}(),t.exports={Gallery:o}},function(t,e,s){!function(e,s){t.exports=s()}(this,function(){return function(t){function __webpack_require__(s){if(e[s])return e[s].exports;var r=e[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.p="",__webpack_require__(0)}([function(t,e,s){s(1),t.exports=s(2)},function(t,e,s){t.exports=s.p+"sortable.css"},function(t,e,s){var r,i,n=function(t,e){return function(){return t.apply(e,arguments)}};r=s(3),i=function(){function Sortable(t,e){var s;null==e&&(e={}),this._grab=n(this._grab,this),this._drop=n(this._drop,this),this._drag=n(this._drag,this),r.config(this,{axis:"vertical",childSelector:null,grabSelector:null},e,t,this.constructor.clsPrefix),this._behaviours={},r.config(this._behaviours,{before:"auto",children:"children",grabber:"self",helper:"clone"},e,t,this.constructor.clsPrefix),this._grabbed=null,this._grabbedOffset=null,this._dom={},this._dom.container=t,this._dom.container.__mh_sortable=this,this._dom.container.classList.add(this._bem("mh-sortable")),Object.defineProperty(this,"container",{value:this._dom.container}),Object.defineProperty(this,"children",{get:function(t){return function(){var e;return function(){var t,s,r,i;for(r=this._dom.children,i=[],t=0,s=r.length;t<s;t++)e=r[t],i.push(e);return i}.call(t)}}(this)}),s=this.constructor.behaviours.children[this._behaviours.children],this._dom.children=s(this),r.listen(document,{mousedown:this._grab,mousemove:this._drag,mouseup:this._drop,touchstart:this._grab,touchmove:this._drag,touchend:this._drop})}return Sortable.clsPrefix="data-mh-sortable--",Sortable.prototype.destroy=function(){return this.container.classList.remove(this._bem("mh-sortable")),r.ignore(document,{mousedown:this._grab,mousemove:this._drag,mouseup:this._drop,touchstart:this._grab,touchmove:this._drag,touchend:this._drop}),delete this._dom.container.__mh_sortable},Sortable.prototype._bem=function(t,e,s){var r;return null==e&&(e=""),null==s&&(s=""),r=t,e&&(r=r+"__"+e),s&&(r=r+"--"+s),r},Sortable.prototype._clearSelection=function(){},Sortable.prototype._et=function(t){return"mh-sortable--"+t},Sortable.prototype._getEventPos=function(t){return t.touches&&(t=t.touches[0]),[t.pageX-window.pageXOffset,t.pageY-window.pageYOffset]},Sortable.prototype._drag=function(t){var e,s,i,n,o,a,u,h,l,p;if(this._grabbed){for(u=this._getEventPos(t),a=[window.pageXOffset,window.pageYOffset],this._dom.helper.style.left=a[0]+u[0]-this._grabbedOffset[0]+"px",this._dom.helper.style.top=a[1]+u[1]-this._grabbedOffset[1]+"px",p=document.elementFromPoint(u[0],u[1]),l=null,h=this._dom.children,n=0,o=h.length;n<o;n++)if(s=h[n],s!==this._grabbed&&s.contains(p)){l=s;break}if(l)return e=this.constructor.behaviours.before[this._behaviours.before],e=e(this,l,u),this.container.removeChild(this._grabbed),e||(l=l.nextElementSibling),this.container.insertBefore(this._grabbed,l),i=this.constructor.behaviours.children[this._behaviours.children],this._dom.children=i(this),r.dispatch(this.container,this._et("sort"),{children:this._dom.children})}},Sortable.prototype._drop=function(t){if(this._grabbed)return this._grabbed.classList.remove(this._bem("mh-sortable-ghost")),this._grabbed=null,this._grabbedOffset=null,document.body.removeChild(this._dom.helper),this._dom.helper=null,this.container.classList.remove(this._bem("mh-sortable",null,"sorting")),r.dispatch(this.container,this._et("sorted"),{children:this._dom.children})},Sortable.prototype._grab=function(t){var e,s,i,n,o,a,u,h,l;if("mousedown"!==t.type.toLowerCase()||1===t.which){for(s=null,l=this._dom.children,o=0,a=l.length;o<a;o++)if(e=l[o],i=this.constructor.behaviours.grabber[this._behaviours.grabber],i(this,e).contains(t.target)){s=e;break}return s?(t.preventDefault(),this._grabbed=s,u=this._getEventPos(t),h=this._grabbed.getBoundingClientRect(),this._grabbedOffset=[u[0]-h.left,u[1]-h.top],n=this.constructor.behaviours.helper[this._behaviours.helper],this._dom.helper=n(this,this._grabbed),document.body.appendChild(this._dom.helper),this._dom.helper.style.left=u[0]-this._grabbedOffset[0]+"px",this._dom.helper.style.top=u[1]-this._grabbedOffset[1]+"px",this._grabbed.classList.add(this._bem("mh-sortable-ghost")),this.container.classList.add(this._bem("mh-sortable",null,"sorting")),r.dispatch(this.container,this._et("grabbed"),{child:s})):void 0}},Sortable.behaviours={before:{auto:function(t,e,s){var r,i,n,o,a,u,h,l;if(l=t.container.getBoundingClientRect().width,t._containerWidth!==l){for(t.axis="vertical",h={},a=t._dom.children,n=0,o=a.length;n<o;n++){if(i=a[n],u=i.getBoundingClientRect().top,h[u]){t.axis="horizontal";break}h[u]=!0}t._containerWidth=l}return(r=t.constructor.behaviours.before.axis)(t,e,s)},axis:function(t,e,s){var r,i;return i=e.getBoundingClientRect(),r=[s[0]-i.left,s[1]-i.top],"vertical"===t.axis?r[1]<i.height/2:r[0]<i.width/2}},children:{children:function(t){var e,s,r;return e=t.container.childNodes,r=1,function(){var t,i,n;for(n=[],t=0,i=e.length;t<i;t++)s=e[t],s.nodeType===r&&n.push(s);return n}()},selector:function(t){return r.many(t.childSelector,t.container)}},grabber:{selector:function(t,e){return r.one(t.grabSelector,e)},self:function(t,e){return e}},helper:{clone:function(t,e){var s,r;return s=e.cloneNode(!0),s.removeAttribute("id"),s.removeAttribute("name"),r=document.defaultView.getComputedStyle(e,"").cssText,s.style.cssText=r,s.style.position="absolute",s.style["pointer-events"]="none",s.classList.add(t._bem("mh-sortable-helper")),s}}},Sortable}(),t.exports={Sortable:i}},function(t,e,s){!function(e,s){t.exports=s()}(this,function(){return function(t){function __webpack_require__(s){if(e[s])return e[s].exports;var r=e[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.p="",__webpack_require__(0)}([function(t,e,s){t.exports=s(1)},function(t,e){var s,r,i,n,o,a,u,h,l=[].indexOf||function(t){for(var e=0,s=this.length;e<s;e++)if(e in this&&this[e]===t)return e;return-1};r=function(t,e){var s,r,i;null==e&&(e={}),s=document.createElement(t);for(r in e)i=e[r],l.call(s,r)>=0?s[r]=i:s.setAttribute(r,i);return s},u=function(t,e){return null==e&&(e=document),Array.prototype.slice.call(e.querySelectorAll(t))},h=function(t,e){return null==e&&(e=document),e.querySelector(t)},i=function(t,e,s){var r,i,n;null==s&&(s={}),r=document.createEvent("Event"),r.initEvent(e,!0,!0);for(i in s)n=s[i],r[i]=n;return t.dispatchEvent(r)},o=function(t,e){var s,r,i,n;n=[];for(r in e)i=e[r],n.push(function(){var e,n,o,a;for(o=r.split(/\s+/),a=[],e=0,n=o.length;e<n;e++)s=o[e],a.push(t.removeEventListener(s,i));return a}());return n},a=function(t,e){var s,r,i,n;n=[];for(r in e)i=e[r],n.push(function(){var e,n,o,a;for(o=r.split(/\s+/),a=[],e=0,n=o.length;e<n;e++)s=o[e],a.push(t.addEventListener(s,i));return a}());return n},s=function(t,e,s,r,i){var n,o,a,u;null==i&&(i="data-"),a=[];for(o in e)u=e[o],t[o]=u,s.hasOwnProperty(o)&&(t[o]=s[o]),n=i+o.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r.hasAttribute(n)?"number"==typeof u?a.push(t[o]=parseInt(r.getAttribute(n))):u===!1?a.push(t[o]=!0):a.push(t[o]=r.getAttribute(n)):a.push(void 0);return a},n=function(t){return t.replace(/[\^\$\\\.\*\+\?\(\)\[\]\{\}\|]/g,"\\$&")},t.exports={create:r,one:h,many:u,dispatch:i,ignore:o,listen:a,config:s,escapeRegExp:n}}])})}])})}])});