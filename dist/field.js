!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ManhattanAssets=e():t.ManhattanAssets=e()}(this,function(){return function(t){function __webpack_require__(s){if(e[s])return e[s].exports;var i=e[s]={exports:{},id:s,loaded:!1};return t[s].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.p="",__webpack_require__(0)}([function(t,e,s){s(4),t.exports=s(5)},,,,function(t,e,s){t.exports=s.p+"field.css"},function(t,e,s){var i,r,n,o,a,u,p;i=s(6),r=s(7).Acceptor,n=s(8).Asset,a=s(9).Monitor,u=s(10).Uploader,p=s(11).Viewer,o=function(){function Field(t,e){null==e&&(e={}),i.config(this,{endpoint:"/upload-asset",label:"Select a file..."},e,t,this.constructor.clsPrefix),this._dom={},this._dom.input=t,this._dom.input.__mh_asset_field=this,this._dom.field=i.create("div",{class:this._bem("mh-asset-field")}),t.parentNode.insertBefore(this._dom.field,t),Object.defineProperty(this,"asset",{get:function(t){return function(){return t._asset}}(this),set:function(t){return function(e){return t._asset=e,t._asset?t.input.value=JSON.stringify(t._asset.toJSONType()):t.input.value="",t._update(),i.dispatch(t.input,t._et("change"),{asset:t.asset})}}(this)}),Object.defineProperty(this,"field",{value:this._dom.field}),Object.defineProperty(this,"input",{value:this._dom.input}),Object.defineProperty(this,"upload",{get:function(t){return function(){return t._upload}}(this)}),this.input.style.display="none",this._asset=null,this.input.value&&(this._asset=n.fromJSONType(JSON.parse(this.input.value))),this._uploader=null,this._upload=null,this._update()}return Field.clsPrefix="data-mh-asset-field--",Field.prototype._bem=function(t,e,s){var i;return null==e&&(e=""),null==s&&(s=""),i=t,e&&(i=i+"__"+e),s&&(i=i+"--"+s),i},Field.prototype._et=function(t){return"mh-assets--"+t},Field.prototype._update=function(){var t,e,s;return this.field.innerHTML="",this.asset?(s=new p(this.asset),i.listen(s.view,{"mh-assets--remove-asset":function(t){return function(){return t.asset=null}}(this)}),this.field.appendChild(s.view)):this.upload?(e=new a(this._uploader,this.upload),this.field.appendChild(e.monitor)):(t=new r(this.label),this.field.appendChild(t.acceptor),this._uploader=new u(t.input,{endpoint:this.endpoint}),i.listen(t.input,{"mh-assets--upload-abort":function(t){return function(e){return t._upload=null,t._update()}}(this),"mh-assets--upload-error":function(t){return function(e){return t._upload=null,t._update()}}(this),"mh-assets--upload-start":function(t){return function(e){return t._upload=e.ref,t._update()}}(this),"mh-assets--upload-success":function(t){return function(e){return t._upload=null,t.asset=e.asset}}(this)}))},Field}(),t.exports={Field:o}},function(t,e,s){!function(e,s){t.exports=s()}(this,function(){return function(t){function __webpack_require__(s){if(e[s])return e[s].exports;var i=e[s]={exports:{},id:s,loaded:!1};return t[s].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.p="",__webpack_require__(0)}([function(t,e,s){t.exports=s(1)},function(t,e){var s,i,r,n,o,a,u,p,h,c,d=[].indexOf||function(t){for(var e=0,s=this.length;e<s;e++)if(e in this&&this[e]===t)return e;return-1};s=function(t,e){var s;if(t.closest)return t.closest(e);for(s=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t&&!s.call(t,e);)t=t.parentElement;return t},r=function(t,e){var s,i,r;null==e&&(e={}),s=document.createElement(t);for(i in e)r=e[i],d.call(s,i)>=0?s[i]=r:s.setAttribute(i,r);return s},h=function(t,e){return null==e&&(e=document),Array.prototype.slice.call(e.querySelectorAll(t))},c=function(t,e){return null==e&&(e=document),e.querySelector(t)},o=function(t,e,s){var i,r,n;null==s&&(s={}),i=document.createEvent("Event"),i.initEvent(e,!0,!0);for(r in s)n=s[r],i[r]=n;return t.dispatchEvent(i)},u=function(t,e){var s,i,r,n;n=[];for(i in e)r=e[i],n.push(function(){var e,n,o,a;for(o=i.split(/\s+/),a=[],e=0,n=o.length;e<n;e++)s=o[e],a.push(t.removeEventListener(s,r));return a}());return n},p=function(t,e){var s,i,r,n;n=[];for(i in e)r=e[i],n.push(function(){var e,n,o,a;for(o=i.split(/\s+/),a=[],e=0,n=o.length;e<n;e++)s=o[e],a.push(t.addEventListener(s,r));return a}());return n},i=function(t,e,s,i,r){var n,o,a,u;null==r&&(r="data-"),a=[];for(o in e)u=e[o],t[o]=u,s.hasOwnProperty(o)&&(t[o]=s[o]),i&&(n=r+o.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i.hasAttribute(n)?"number"==typeof u?a.push(t[o]=parseInt(i.getAttribute(n))):u===!1?a.push(t[o]=!0):a.push(t[o]=i.getAttribute(n)):a.push(void 0));return a},a=function(t){return t.replace(/[\^\$\\\.\*\+\?\(\)\[\]\{\}\|]/g,"\\$&")},n=function(t){var e;try{document.querySelector(t)}catch(t){return e=t,!1}return!0},t.exports={closest:s,create:r,one:c,many:h,dispatch:o,ignore:u,listen:p,config:i,escapeRegExp:a,cssSelectorSupported:n}}])})},function(t,e,s){var i,r;i=s(6),r=function(){function Acceptor(t){null==t&&(t="Select a file..."),this._dom={},this._dom.acceptor=i.create("div",{class:this._bem("mh-assets-acceptor")}),this._dom.acceptor.__mh_acceptor=this,this._dom.input=i.create("input",{class:this._bem("mh-assets-acceptor","input"),type:"file",name:"acceptor__"+this._newId()}),this._dom.acceptor.appendChild(this._dom.input),this._dom.label=i.create("div",{class:this._bem("mh-assets-acceptor","label")}),this._dom.label.textContent=t,this._dom.acceptor.appendChild(this._dom.label),Object.defineProperty(this,"acceptor",{value:this._dom.acceptor}),Object.defineProperty(this,"input",{value:this._dom.input})}return Acceptor._counter=0,Acceptor.prototype._bem=function(t,e,s){var i;return null==e&&(e=""),null==s&&(s=""),i=t,e&&(i=i+"__"+e),s&&(i=i+"--"+s),i},Acceptor.prototype._newId=function(){return Acceptor._counter+=1,Acceptor._counter},Acceptor}(),t.exports={Acceptor:r}},function(t,e){var s,i;s=function(){function Asset(t,e,s,r,n,o,a,u){this._key=t,this._filename=e,this._type=s,this._contentType=r,this._urls=n,this.meta=new i(o,a),this._variations=u,Object.defineProperty(this,"key",{value:this._key}),Object.defineProperty(this,"filename",{value:this._filename}),Object.defineProperty(this,"type",{value:this._type}),Object.defineProperty(this,"contentType",{value:this._contentType}),Object.defineProperty(this,"urls",{get:function(t){return function(){var e,s,i;n={},s=t._urls;for(e in s)i=s[e],n[e]=i;return n}}(this)})}return Asset.prototype.toJSONType=function(){return{key:this.key,filename:this.filename,type:this.type,content_type:this.contentType,url:this.urls.origin,core_meta:this.meta.getCoreMeta(),user_meta:this.meta.getUserMeta(),variations:this._variations}},Asset.fromJSONType=function(t){var e;return e={origin:t.url},"image"===t.type&&t.variations&&(t.variations["--draft--"]&&(e.draft=t.variations["--draft--"].url),t.variations["--thumb--"]&&(e.thumb=t.variations["--thumb--"].url)),new Asset(t.key,t.filename,t.type,t.content_type,e,t.core_meta,t.user_meta,t.variations)},Asset}(),i=function(){function AssetMeta(t,e){var s,i,r,n,o,a,u,p;this._coreMeta=t||{},this._coreOverrides={},i=function(t){return function(e){return t=t,function(){return void 0!==t._coreOverrides[e]?t._coreOverrides[e]:void 0!==t._coreMeta[e]?t._coreMeta[e]:void 0}}}(this),u=function(t){return function(e){return t=t,function(s){return t._coreOverrides[e]=s}}}(this),o=this._coreMeta;for(n in o)s=o[n],Object.defineProperty(this,n,{get:i(n),set:u(n)});a=e||{};for(r in a)p=a[r],this[r]=p}return AssetMeta.prototype.getCoreMeta=function(){return JSON.parse(JSON.stringify(this._coreMeta))},AssetMeta.prototype.getUserMeta=function(){var t,e,s,i;t=JSON.parse(JSON.stringify(this._coreOverrides)),s=this;for(e in s)i=s[e],this.hasOwnProperty(e)&&!this[e]instanceof Function&&(t[e]=i);return JSON.parse(JSON.stringify(t))},AssetMeta}(),t.exports={Asset:s}},function(t,e,s){var i,r;i=s(6),r=function(){function Monitor(t,e){this._uploader=t,this._upload=e,this._dom={},this._dom.monitor=i.create("div",{class:this._bem("mh-assets-monitor")}),this._dom.monitor.__mh_monitor=this,Object.defineProperty(this,"uploader",{value:this._uploader}),Object.defineProperty(this,"upload",{value:this._upload}),Object.defineProperty(this,"monitor",{value:this._dom.monitor}),i.listen(this.uploader.input,{"mh-assets--upload-progress":function(t){return function(e){if(e.ref===t.upload)return t._dom.gauge.setAttribute("data-mh-progress",parseInt(100*e.progress)+"%"),t._dom.progress.style.width=100*e.progress+"%"}}(this),"mh-assets--upload-end":function(t){return function(e){if(e.ref===t.upload)return t.monitor.classList.add(t._bem("mh-asset-monitor","","complete")),i.dispatch(t.monitor,t._et("monitor-complete"))}}(this)}),this._template()}return Monitor.prototype._bem=function(t,e,s){var i;return null==e&&(e=""),null==s&&(s=""),i=t,e&&(i=i+"__"+e),s&&(i=i+"--"+s),i},Monitor.prototype._et=function(t){return"mh-assets--"+t},Monitor.prototype._template=function(){return this._dom.gauge=i.create("div",{class:this._bem("mh-assets-monitor","gauge"),"data-mh-progress":"0%"}),this.monitor.appendChild(this._dom.gauge),this._dom.progress=i.create("div",{class:this._bem("mh-assets-monitor","progress")}),this._dom.gauge.appendChild(this._dom.progress),this._dom.cancel=i.create("div",{class:this._bem("mh-assets-monitor","cancel")}),this.monitor.appendChild(this._dom.cancel),i.listen(this._dom.cancel,{click:function(t){return function(e){return e.preventDefault(),t.uploader.cancel(t.upload)}}(this)})},Monitor}(),t.exports={Monitor:r}},function(t,e,s){var i,r,n;i=s(6),r=s(8).Asset,n=function(){function Uploader(t,e){null==e&&(e={}),this._dom={},this._dom.input=t,this._dom.input.__mh_assets_uploader=this,this._uploads={},this._queued_uploads=[],Object.defineProperty(this,"input",{value:this._dom.input}),Object.defineProperty(this,"uploadCount",{get:function(t){return function(){var e,s;return function(){var t,i;t=this._uploads,i=[];for(s in t)e=t[s],i.push(s);return i}.call(t).length}}(this)}),i.config(this,{allowMultiple:!1,endpoint:"/cms/upload-asset",maxConcurrentUploads:2},e),this._behaviours={},i.config(this._behaviours,{formData:"manhattan",response:"manhattan"},e),this.allowMultiple&&this.input.setAttribute("multiple",!0),i.listen(this.input,{change:function(t){return function(e){var s,i,r,n;if(t.allowMultiple)for(n=e.target.files,i=0,r=n.length;i<r;i++)s=n[i],t._upload(s);else t._upload(e.target.files[0]);if(t.input.value="",t.input.value)return t.input.type="text",t.input.type="file"}}(this)})}return Uploader.prototype.cancel=function(t){var e,s,i;if(!t){i=[];for(s in uploads)e=uploads[s],i.push(s.abort());return i}if(this._uploads[t])return t.abort()},Uploader.prototype.progress=function(t){var e,s,i;if(!t){i=0;for(e in uploads)s=uploads[e],i+=s.progress;return i/Math.max(1,this.uploadCount)}if(this._uploads[t])return this._uploads[t].progress},Uploader.prototype._clear=function(t){var e;return this._uploads[t]&&delete this._uploads[t],this._queued_uploads.length>0&&(e=this._queued_uploads.shift(),this._start_upload(e[0],e[1])),i.dispatch(this.input,this._et("upload-end"),{ref:t})},Uploader.prototype._start_upload=function(t,e){return this._uploads[t]={progress:0},i.dispatch(this.input,this._et("upload-start"),{ref:t}),t.open("POST",this.endpoint,!0),t.send(e)},Uploader.prototype._et=function(t){return"mh-assets--"+t},Uploader.prototype._on_abort=function(t){if(this._uploads[t])return i.dispatch(this.input,this._et("upload-abort"),{ref:t}),this._clear(t)},Uploader.prototype._on_error=function(t,e){if(null==e&&(e=""),this._uploads[t])return i.dispatch(this.input,this._et("upload-error"),{ref:t,reason:e}),this._clear(t)},Uploader.prototype._on_progress=function(t,e){if(this._uploads[t])return this._uploads[t].progress=e,i.dispatch(this.input,this._et("upload-progress"),{ref:t,progress:e})},Uploader.prototype._on_success=function(t,e){if(this._uploads[t])return i.dispatch(this.input,this._et("upload-success"),{ref:t,asset:e}),this._clear(t)},Uploader.prototype._upload=function(t){var e,s,i,n,o,a,u,p;return s=this._behaviours.formData,e=this.constructor.behaviours.formData[s],i=e(this,t),p=new XMLHttpRequest,u=function(t,e){return function(s){return t._on_progress(e,s.loaded/s.total)}},p.upload.addEventListener("progress",u(this,p)),a=function(t,i){return function(n){var o,a,u;return u=n.target.responseText,s=t._behaviours.response,a=t.constructor.behaviours,e=a.response[s],o=e(this,i.responseText),o instanceof r?t._on_success(i,o):t._on_error(i,o.message)}},p.addEventListener("load",a(this,p)),o=function(t,e){return function(s){return t._on_error(e)}},p.addEventListener("error",o(this,p)),n=function(t,e){return function(s){return t._on_abort(e)}},p.addEventListener("abort",n(this,p)),this.uploadCount<this.maxConcurrentUploads?this._start_upload(p,i):this._queued_uploads.push([p,i])},Uploader.behaviours={formData:{manhattan:function(t,e){var s,r;return r=new FormData,r.append("file",e),s=i.one('[name="csrf_token"]',t.input.form),s&&r.append("csrf_token",s.value),r}},response:{manhattan:function(t,e){var s,i;try{i=JSON.parse(e)}catch(t){return s=t,new Error("Unable to parse response")}return"success"===i.status?r.fromJSONType(i.payload.asset):new Error(i.payload.reason)}}},Uploader}(),t.exports={Uploader:n}},function(t,e,s){var i,r;i=s(6),r=function(){function Viewer(t){this._asset=t,this._dom={},this._dom.view=i.create("div",{class:this._bem("mh-assets-view")}),this._dom.view.__mh_viewer=this,Object.defineProperty(this,"asset",{value:this._asset}),Object.defineProperty(this,"view",{value:this._dom.view}),this._template(),this._populate()}return Viewer.prototype._bem=function(t,e,s){var i;return null==e&&(e=""),null==s&&(s=""),i=t,e&&(i=i+"__"+e),s&&(i=i+"--"+s),i},Viewer.prototype._et=function(t){return"mh-assets--"+t},Viewer.prototype._populate=function(){var t,e;return"image"===this.asset.type?this.view.classList.add(this._bem("mh-assets-view","","image")):this.view.classList.add(this._bem("mh-assets-view","","file")),"image"===this.asset.type?this._dom.thumb.style["background-image"]="url("+this.asset.urls.thumb+")":this._dom.icon.setAttribute("data-mh-content-type",this.asset.contentType),this._dom.filename.textContent=this.asset.filename,this.asset.meta.length&&(t=this.asset.meta.length/1e3,e="kb",t>1e3&&(t/=1e3,e="mb"),t=t.toFixed(1),t=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),this._dom.fileSize.textContent=""+t+e),this._dom.download.setAttribute("href",this.asset.urls.origin)},Viewer.prototype._template=function(){return this._dom.content=i.create("div",{class:this._bem("mh-assets-view","content")}),this.view.appendChild(this._dom.content),this._dom.icon=i.create("div",{class:this._bem("mh-assets-view","icon")}),this._dom.content.appendChild(this._dom.icon),this._dom.thumb=i.create("div",{class:this._bem("mh-assets-view","thumb")}),this._dom.content.appendChild(this._dom.thumb),this._dom.info=i.create("div",{class:this._bem("mh-assets-view","info")}),this.view.appendChild(this._dom.info),this._dom.filename=i.create("div",{class:this._bem("mh-assets-view","filename")}),this._dom.info.appendChild(this._dom.filename),this._dom.fileSize=i.create("div",{class:this._bem("mh-assets-view","file-size")}),this._dom.info.appendChild(this._dom.fileSize),this._dom.actions=i.create("div",{class:this._bem("mh-assets-view","actions")}),this.view.appendChild(this._dom.actions),this._dom.download=i.create("a",{download:!0,target:"_blank"}),this._dom.download.classList.add(this._bem("mh-assets-view","action")),this._dom.download.classList.add(this._bem("mh-assets-view","action","download")),this._dom.download.textContent="Download",this._dom.actions.appendChild(this._dom.download),this._dom.remove=i.create("a",{href:"#"}),this._dom.remove.classList.add(this._bem("mh-assets-view","action")),this._dom.remove.classList.add(this._bem("mh-assets-view","action","remove")),this._dom.remove.textContent="Remove",this._dom.actions.appendChild(this._dom.remove),i.listen(this._dom.remove,{click:function(t){return function(e){return e.preventDefault(),i.dispatch(t.view,t._et("remove-asset"),{asset:t.asset})}}(this)})},Viewer}(),t.exports={Viewer:r}}])});